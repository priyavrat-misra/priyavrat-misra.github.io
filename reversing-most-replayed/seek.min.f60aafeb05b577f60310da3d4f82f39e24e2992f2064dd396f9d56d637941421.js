(function(){"use strict";document.addEventListener("DOMContentLoaded",()=>{const m=30,u=20,O=.5,h=60,e=24,d=5,b=3,p=6;let l,n,t,s,r,c;const o=u+b,w=[{id:"canvasBool",name:"Bool"},{id:"canvasAccumulate",name:"Accumulate"},{id:"canvasRaw",name:"Raw"},{id:"canvasHisto",name:"Histo"},{id:"canvasPrefix",name:"Prefix"}],i=[];w.forEach(e=>{const t=document.getElementById(e.id);i.push({name:e.name,canvas:t,ctx:t.getContext("2d"),position:0,segments:e.name==="Prefix"?new Array(11).fill(0):new Array(10).fill(0),lastPos:0,isAnimating:!1})});function g(){l=i[0].canvas.offsetWidth,n=l*.8,t=n/10;const o=e+d+n+d+e;s=(l-o)/2+e+d,r=s-e-d,c=s+n+d,i.forEach(e=>{e.canvas.width=l,e.canvas.height=100})}const f={Bool:e=>{for(let n=0;n<10;n++)e.segments[n]=e.position>=(n+1)*t?1:0},Accumulate:e=>{for(let n=0;n<10;n++){const s=(n+1)*t;e.position>=s&&e.lastPos<s&&e.segments[n]++}},Raw:e=>f.Accumulate(e),Histo:e=>f.Accumulate(e),Prefix:e=>{e.position>=t&&e.lastPos<t&&!e.segments[0]&&e.segments[0]++,e.position>=n&&e.segments[10]--}};function x(){const e=getComputedStyle(document.body);return{bg:e.getPropertyValue("--color-canvas-default"),fg:e.getPropertyValue("--color-fg-default"),muted:e.getPropertyValue("--color-fg-muted"),accent:e.getPropertyValue("--color-accent-fg"),border:e.getPropertyValue("--color-border-default"),canvasSubtle:e.getPropertyValue("--color-canvas-subtle")}}function v(e,n,o,i){const c=Math.max(...n,1),a=Math.min(...n),r=c-a||1;e.strokeStyle=i.border,e.fillStyle=i.border,e.lineWidth=2,e.beginPath();for(let i=0;i<10;i++){const c=s+i*t+t/2,l=o?15-(n[i]-a)/r*10:15-n[i]*2;i===0?e.moveTo(c,l):e.lineTo(c,l)}e.stroke(),e.fillStyle=i.fg;for(let i=0;i<10;i++){const c=s+i*t+t/2,l=o?15-(n[i]-a)/r*10:15-n[i]*2;e.beginPath(),e.arc(c,l,2,0,2*Math.PI),e.fill()}e.lineWidth=1}function a(i){const a=x();i.ctx.clearRect(0,0,l,100),i.name==="Raw"&&v(i.ctx,i.segments,!1,a),i.name==="Histo"&&v(i.ctx,i.segments,!0,a),i.ctx.fillStyle=a.canvasSubtle,i.ctx.fillRect(r,o,e,e),i.ctx.strokeStyle=a.fg,i.ctx.lineWidth=1,i.ctx.strokeRect(r,o,e,e),i.ctx.fillStyle=a.canvasSubtle,i.ctx.fillRect(c,o,e,e),i.ctx.strokeRect(c,o,e,e),i.ctx.fillStyle=a.fg,i.ctx.font="16px Arial",i.ctx.textAlign="center",i.ctx.textBaseline="middle";const d=o+e/2+1;i.ctx.fillText(i.isAnimating?"⏸":"▶",r+e/2,d),i.ctx.fillText("↻",c+e/2,d),i.ctx.fillStyle=a.border,i.ctx.fillRect(s,u,n,m),i.ctx.fillStyle=a.accent,i.ctx.fillRect(s,u,i.position,m),i.ctx.fillStyle=a.fg,i.ctx.fillRect(s+i.position-p/2,u-b,p,m+p),i.ctx.textBaseline="alphabetic";for(let e=0;e<10;e++){const n=s+e*t;i.ctx.strokeStyle=a.fg,i.ctx.strokeRect(n,h,t,30),i.ctx.fillStyle=a.fg,i.ctx.textAlign="center",i.ctx.fillText(i.segments[e],n+t/2,h+20)}if(i.name==="Prefix"){const e=s+10*t;i.ctx.strokeRect(e,h,t,30),i.ctx.fillText(i.segments[10],e+t/2,h+20)}}function j(){let e=!1;i.forEach(t=>{t.isAnimating&&t.position<n&&(e=!0,t.lastPos=t.position,t.position+=O,t.position>n&&(t.position=n),f[t.name](t),t.position>=n&&(t.isAnimating=!1)),a(t),t.isAnimating&&(e=!0)}),e&&requestAnimationFrame(j)}function C(){i.forEach(e=>{e.canvas.tabIndex=0,e.canvas.setAttribute("role","application"),e.canvas.setAttribute("aria-label",`Visualization for ${e.name} algorithm`),e.canvas.addEventListener("mousedown",t=>{k(e,t.offsetX,t.offsetY)}),e.canvas.addEventListener("keydown",t=>{t.key===" "&&(y(e),t.preventDefault())})})}function y(e){e.isAnimating=!e.isAnimating,e.isAnimating&&j()}function E(e){e.isAnimating=!1,e.position=0,e.segments.fill(0),e.lastPos=0,a(e)}function k(i,l,d){if(l>=r&&l<=r+e&&d>=o&&d<=o+e){y(i);return}if(l>=c&&l<=c+e&&d>=o&&d<=o+e){E(i);return}const u=l-s;if(u>=0&&u<=n){if(i.name==="Prefix"){const e=Math.floor(i.position/t);e<11&&i.segments[e+1]--,i.position=Math.max(0,Math.min(n,u));const s=Math.floor(i.position/t);s<11&&i.segments[s]++}else i.position=Math.max(0,Math.min(n,u));a(i)}}g(),i.forEach(a),C();let _;window.addEventListener("resize",()=>{clearTimeout(_),_=setTimeout(()=>{g(),i.forEach(a)},250)}),document.getElementById("dark").addEventListener("change",()=>{setTimeout(()=>i.forEach(a),50)})})})()